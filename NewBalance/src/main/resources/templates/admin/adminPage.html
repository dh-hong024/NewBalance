<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
    <link rel="stylesheet" href="//code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
    <script src="https://code.jquery.com/jquery-3.2.1.min.js"></script>
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
    <meta charset="UTF-8">
    <title>Title</title>
</head>
<body>
<style>
    .menu .hide{
        display: none;
    }

    .menu a{
        cursor: pointer;
    }
    .modal{
        display: none;
        position: fixed;
        z-index: 1;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        overflow: auto;
        background-color: rgba(0, 0, 0, 0.4);
    }
    .modal-content {
        background-color: #fefefe;
        margin: 15% auto;
        padding: 20px;
        border: 1px solid #888;
        width: 80%;
    }
    .close {
        color: #aaa;
        float: right;
        font-size: 28px;
        font-weight: bold;
    }
    .close:hover,
    .close:focus {
        color: black;
        text-decoration: none;
        cursor: pointer;
    }
    #noticesTable, #noticeEdit, #loadNoticeMore, #membersTable, #loadMemberMore, #faqsDivList, #categoryDivList, #couponDivList, #loadCouponMore {
        display: none;
    }

    .tabs > .tab-item > a{
        color: black;
    }
    .tab_list > col3{
        float: left;
    }
    .tabs > .tab-item {
        float: left;
        list-style: none;
        padding: 10px;
        margin: 10px 10px 0 0;
        cursor: pointer;
        border: solid #dbdbdb;
    }
    .category_tabs > .category_tabs a{
        color: black;
    }
    .category_tabs > .tab-item {
        float: left;
        list-style: none;
        padding: 10px;
        margin: 10px 10px 0 0;
        cursor: pointer;
        border: solid #dbdbdb;
    }

    .inner {
        display: flex;
        gap: 20px; /* 각 .depth 요소 간의 간격 */
    }

    .depth ul {
        list-style-type: none;
        padding: 0;
        margin: 0;
        flex-grow: 1; /* ul 태그가 남은 공간을 채우도록 설정 */
        margin-bottom: 10px; /* 목록과 버튼 그룹 사이의 간격 */
    }

    .depth .cateBtn input[type="text"] {
        margin-bottom: 5px; /* 텍스트 입력 박스와 버튼들 사이의 간격 */
    }

    .depth .cateBtn .buttons {
        display: flex;
        gap: 5px; /* 버튼들 사이의 간격 */
    }
</style>
<h2>관리자페이지</h2>
<!-- 메뉴 토글 시작 -->
<div>
    <ul>
        <li class="menu">
            <a>게시판관리</a>
            <ul class="hide">
                <li><a href="" id="noticeList">공지사항</a></li>
                <li><a href="" id="faqList">faq</a></li>
            </ul>
        </li>

        <li class="menu">
            <a>회원메뉴</a>
            <ul class="hide">
                <li><a href="" id="memberList">회원관리</a></li>
            </ul>
        </li>

        <li class="menu">
            <a>카테고리메뉴</a>
            <ul class="hide">
                <li><a href="" id="categoryList">카테고리관리</a></li>
            </ul>
        </li>

        <li class="menu">
            <a>쿠폰메뉴</a>
            <ul class="hide">
                <li><a href="" id="couponList">쿠폰관리</a></li>
            </ul>
        </li>


    </ul>
</div>
<!-- 메뉴 토글 끝 -->


<!-- 공지사항 시작-->
<div>
    <table id="noticesTable" class="table table-striped">
        <thead>
        <tr>
            <th>#</th>
            <th>제목</th>
            <th>등록일</th>
            <th>조회수</th>
        </tr>
        </thead>
        <tbody>

        </tbody>
    </table>

    <button id="noticeEdit" th:onclick="|location.href='@{/admin/notice-form}'|"  sec:authorize="hasRole('ROLE_ADMIN')">글쓰기</button>

    <button id="loadNoticeMore">더보기</button>

    <!-- Notice 모달 창 -->
    <div id="noticeModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <input type="hidden" id="noticeModalId">
            <h2><input type="text" id="noticeModalTitle" ></h2>
            <p><textarea id="noticeModalContent"></textarea></p>
            <p>조회수: <span id="noticeModalCount"></span></p>
            <p>수정 날짜: <span id="noticeModalModifiedDate"></span></p>
            <div>
                <button id="editNoticeBtn" class="btn btn-primary"  sec:authorize="hasRole('ROLE_ADMIN')">수정</button>
                <button id="deleteNoticeBtn" class="btn btn-primary"  sec:authorize="hasRole('ROLE_ADMIN')">삭제</button>
            </div>
        </div>
    </div>
</div>
<!-- 공지사항 끝 -->

<!-- faqs 시작 -->
<div id="faqsDivList">
    <h2>FAQs</h2>
    <div class="form-group">
            <input type="hidden" id="tag" name="tag">
            <input type="hidden" id="page" name="page">
            <input type="text" id="condition" name="condition">
            <button type="button" id="submitBtn">검색</button>
    </div>
    <div>
        <a href="" id="faqEditBtn" sec:authorize="hasRole('ROLE_ADMIN')">글쓰기</a>

        <ul class="tabs">
            <input type="hidden" th:value="${tag}">
            <input type="hidden" id="condition-hidden" th:value="${condition}">
            <li class="tab-item" id="all" data-tab="tab-1"><a href="#">전체</a></li>
            <li class="tab-item" id="website" data-tab="tab-2"><a href="#">웹사이트</a></li>
            <li class="tab-item" id="mileage" data-tab="tab-3"><a href="#">통합 마일리지</a></li>
            <li class="tab-item" id="repair" data-tab="tab-4" ><a href="#">수선(A/S)</a></li>
            <li class="tab-item" id="store" data-tab="tab-5" ><a href="#">매장 관련</a></li>
            <li class="tab-item" id="product" data-tab="tab-6" ><a href="#">제품</a></li>
            <li class="tab-item" id="members" data-tab="tab-7" ><a href="#">멤버스</a></li>
            <li class="tab-item" id="return" data-tab="tab-8" ><a href="#">교환/반품</a></li>
        </ul>
    </div>
    <br><br><br>
    <div class="contents">
        <div class="content">

        </div>
    </div>
    <div class="paging">
        <button type="button" id="pagingBtn" th:text="'더보기(' + ${count} + ')'"></button>
    </div>
</div>
<!-- faqs 끝 -->

<!-- faqs Edit Modal 시작 -->
<div id="faqEditModal" class="modal">
    <div class="modal-content">
        <span class="close">&times;</span>
        <form id="faqModalForm">
            <select id="tagEditSelect"></select>
            <p><textarea id="faqEditQuestionModalContent"></textarea></p>
            <p><textarea id="faqEditAnswerModalContent"></textarea></p>
            <div>
                <button type="button" id="editFaqBtn" class="btn btn-primary"  sec:authorize="hasRole('ROLE_ADMIN')">등록</button>
                <button type="button" id="cancelEditFaqBtn" class="btn btn-primary"  sec:authorize="hasRole('ROLE_ADMIN')">취소</button>
            </div>
        </form>
    </div>
</div>

<!-- faqs Edit Modal 끝 -->

<!-- update Modal 시작 -->
<div id="faqUpdateModal" class="modal">
    <div class="modal-content">
        <span class="close">&times;</span>
        <h2>Update FAQ</h2>
        <form id="faqUpdateModalForm">
            <input type="hidden" id="faqUpdateId">
            <select id="tagUpdateSelect"></select><br>
            <textarea id="faqUpdateQuestionModalContent"></textarea><br>
            <textarea id="faqUpdateAnswerModalContent"></textarea><br>
            <div>
                <button id="updateFaqBtn" class="btn btn-primary"  sec:authorize="hasRole('ROLE_ADMIN')">수정</button>
                <button id="deleteFaqBtn" class="btn btn-primary"  sec:authorize="hasRole('ROLE_ADMIN')">삭제</button>
            </div>
        </form>
    </div>
</div>
<!-- update Modal 끝 -->


<!-- member List 시작-->
<div>
    <table id="membersTable" class="table table-striped">
        <thead>
        <tr>
            <th>아이디</th>
            <th>이메일</th>
            <th>닉네임</th>
            <th>성별</th>
            <th>권한</th>
        </tr>
        </thead>
        <tbody>

        </tbody>
    </table>

    <button id="loadMemberMore">더보기</button>
</div>
<!-- member List 끝 -->

<!-- category 시작-->
<div id="categoryDivList">
    <ul class="clearfix">
            <li class="nav">
                    <ul class="category_tabs">
                        <li class="tab-item" id="men" data-tab="tab-1" data-title="MEN"><a>Men</a></li>
                        <li class="tab-item" id="women" data-tab="tab-2" data-title="WOMEN"><a>Women</a></li>
                        <li class="tab-item" id="kids" data-tab="tab-3" data-title="KIDS"><a>Kids</a></li>
                    </ul>
            </li>

        <br><br>

        <div class="inner" id="cateMan">
            <div class="depth">
                <strong class="tit">Featured</strong>
                <div class="content">
                        <ul id="ul_Featured">
                            <!-- 내용 추가 -->
                        </ul>
                        <div class="cateBtn">
                            <input type="text" id="depth_1" data-ref="1"><br>
                            <div class="buttons">
                                <input type="button" id="depth_1_BtnAdd" value="추가">
                                <input type="button" id="depth_1_BtnEdit" value="수정">
                                <input type="button" id="depth_1_BtnDelete" value="삭제">
                            </div>
                        </div>
                    </div>
                </div>

                <div class="depth">
                    <strong class="tit">신발</strong>
                    <div class="content">
                        <ul id="ul_Shoes">
                            <!-- 내용 추가 -->
                        </ul>
                        <div class="cateBtn">
                            <input type="text" id="depth_2" data-ref="2"><br>
                            <div class="buttons">
                                <input type="button" id="depth_2_BtnAdd" value="추가">
                                <input type="button" id="depth_2_BtnEdit" value="수정">
                                <input type="button" id="depth_2_BtnDelete" value="삭제">
                            </div>
                        </div>
                    </div>
                </div>

                <div class="depth">
                    <strong class="tit">의류</strong>
                    <div class="content">
                    <ul id="ul_Clothing">
                        <!-- 내용 추가 -->
                    </ul>
                        <div class="cateBtn">
                            <input type="text" id="depth_3" data-ref="3"><br>
                            <div class="buttons">
                                <input type="button" id="depth_3_BtnAdd" value="추가">
                                <input type="button" id="depth_3_BtnEdit" value="수정">
                                <input type="button" id="depth_3_BtnDelete" value="삭제">
                            </div>
                        </div>
                    </div>
                </div>

                <div class="depth">
                    <strong class="tit">용품</strong>
                    <div class="content">
                    <ul id="ul_Supplies">
                        <!-- 내용 추가 -->
                    </ul>
                        <div class="cateBtn">
                            <input type="text" id="depth_4" data-ref="4"><br>
                            <div class="buttons">
                                <input type="button" id="depth_4_BtnAdd" value="추가">
                                <input type="button" id="depth_4_BtnEdit" value="수정">
                                <input type="button" id="depth_4_BtnDelete" value="삭제">
                            </div>
                        </div>
                    </div>
                </div>

                <div class="depth" id="cateUnderwear">
                    <strong class="tit">언더웨어</strong>
                    <div class="content">
                    <ul id="ul_Underwear">
                        <!-- 내용 추가 -->
                    </ul>
                        <div class="cateBtn">
                            <input type="text" id="depth_5" data-ref="5"><br>
                            <div class="buttons">
                                <input type="button" id="depth_5_BtnAdd" value="추가">
                                <input type="button" id="depth_5_BtnEdit" value="수정">
                                <input type="button" id="depth_5_BtnDelete" value="삭제">
                            </div>
                        </div>
                    </div>
                </div>

                <div class="depth" id="cateSports">
                    <strong class="tit">스포츠</strong>
                    <div class="content">
                    <ul id="ul_Sports">
                        <!-- 내용 추가 -->
                    </ul>
                        <div class="cateBtn">
                            <input type="text" id="depth_6" data-ref="6"><br>
                            <div class="buttons">
                                <input type="button" id="depth_6_BtnAdd" value="추가">
                                <input type="button" id="depth_6_BtnEdit" value="수정">
                                <input type="button" id="depth_6_BtnDelete" value="삭제">
                            </div>
                        </div>
                    </div>
                </div>

                <div class="depth" id="cateKids">
                    <strong class="tit">연중판매</strong>
                    <div class="content">
                    <ul id="ul_YearRound">
                        <!-- 내용 추가 -->
                    </ul>
                        <div class="cateBtn">
                            <input type="text" id="depth_7" data-ref="7"><br>
                            <div class="buttons">
                                <input type="button" id="depth_7_BtnAdd" value="추가">
                                <input type="button" id="depth_7_BtnEdit" value="수정">
                                <input type="button" id="depth_7_BtnDelete" value="삭제">
                            </div>
                        </div>
                    </div>
                </div>
        </div>
    </ul>
</div>
<!-- category menu 끝-->

<!-- coupon 목록 시작 -->
<div id="couponDivList">
    <div>
        <div id="couponAdd">
            <h2>쿠폰등록</h2>
            <button id="couponEditBtn" sec:authorize="hasRole('ROLE_ADMIN')">등록</button>
        </div>
        <h2>쿠폰목록</h2>
        <table id="couponTable">
            <thead>
                <tr>
                    <th>혜택</th>
                    <th>쿠폰명</th>
                    <th>사용기간</th>
                    <th>수량</th>
                    <th>상태</th>
                </tr>
            </thead>
            <tbody>

            </tbody>
        </table>
        <button id="loadCouponMore">더보기</button>
    </div>
</div>

<!-- coupon 목록 끝 -->

<!-- coupon Add Modal 시작 -->
<div id="CouponEditModal" class="modal">
    <div class="modal-content">
        <span class="close">&times;</span>
        <form id="CouponModalForm">
            <p>title<input type="text" id="CouponEditTitle"></p>
            <p>code<input type="text" id="CouponEditCode"></p> <button type="button" id="randomCodeBtn">코드생성</button>
            <p>period<input type="text" id="CouponEditPeriod"></p>
            <p>benefit
                <select id="CouponEditBenefit">
                    <option value="5">5%</option>
                    <option value="10">10%</option>
                    <option value="15">15%</option>
                    <option value="20">20%</option>
                    <option value="25">25%</option>
                    <option value="30">30%</option>
                </select>
            </p>
            <p>quantity<input type="text" id="CouponEditQuantity"></p>
            <div>
                <button type="button" id="editCouponBtn" class="btn btn-primary"  sec:authorize="hasRole('ROLE_ADMIN')">등록</button>
                <button type="button" id="cancelEditCouponBtn" class="btn btn-primary"  sec:authorize="hasRole('ROLE_ADMIN')">취소</button>
            </div>
        </form>
    </div>
</div>
<!-- coupon Add Modal 끝 -->


<script th:inline="javascript">
    let pageNumber = 0;

    $(document).ready(function () {
        let offset = 0;
        const limit = 10;

        // 메뉴 토글
        $(".menu>a").click(function () {
            const submenu = $(this).next("ul");
            if (submenu.is(":visible")) {
                submenu.slideUp();
            } else {
                submenu.slideDown();
            }
        });

        // 모달 초기화
        $('#noticeModal').on('show.bs.modal', function () {
            $('#noticeModalCount').prop('disable', true);
            $('#noticeModalModifiedDate').prop('disable', true);
        });

        // 공지사항 목록 로드
        function noticeList(append = false) { // append가 true일 경우 기존 목록 유지하고 새로 가져온 목록내용추가 더보기 버튼 클릭시 true
            $.ajax({
                url: '/admin/notices',
                type: 'GET',
                data: {offset: offset, limit: limit},
                dataType: 'json',
                success: function (response) {
                    const noticeTableBody = $('#noticesTable tbody');
                    if (!append) noticeTableBody.empty(); // append가 false면 기존 목록을 지움
                    $.each(response.notices, function (index, notice) {
                        const row = $('<tr>');
                        row.html(`
                            <td>${notice.id}</td>
                            <td><a href="#" class="notice-link" data-id="${notice.id}" data-noticetitle="${notice.noticeTitle}" data-noticecontent="${notice.noticeContent}" data-modifieddate="${notice.modifiedDate}" data-noticecount="${notice.noticeCount}">${notice.noticeTitle}</a></td>
                            <td>${formatDate(notice.modifiedDate)}</td>
                            <td>${notice.noticeCount}</td>
                        `);
                        noticeTableBody.append(row);
                    });

                    $('.notice-link').click(showNoticeModal);

                    const remingCount = Math.max(0, response.totalNotices - (offset + limit));
                    $('#loadNoticeMore').text('더보기(' + remingCount + ')');

                    // 더보기 버튼 표시 여부 결정
                    if (remingCount <= 0) {
                        $('#loadNoticeMore').hide();
                    } else {
                        $('#loadNoticeMore').show();
                    }
                },
                error: function (xhr, status, error) {
                    console.error('Error fetching notices:', error);
                }
            });
        }// 공지사항 목록 로드 끝

        // 회원목록 로드
        function memberList(append = false) {
            $.ajax({
                url: "/admin/membersList",
                type: 'GET',
                data: {offset: offset, limit: limit},
                dataType: 'json',
                success: function (response) {
                    const membersTableBody = $('#membersTable tbody');
                    if (!append) membersTableBody.empty();
                    $.each(response.members, function (index, member) {
                        const row = $('<tr>');
                        row.html(`
                            <td>${member.userId}</td>
                            <td>${member.email}</td>
                            <td>${member.name}</td>
                            <td>${member.sex}</td>
                            <td>${member.role}</td>
                        `);
                        membersTableBody.append(row);
                    });
                    const remingCount = Math.max(0, response.totalMembers - (offset + limit));
                    $('#loadMemberMore').text('더보기(' + remingCount + ')');
                    if (remingCount <= 0) {
                        $('#loadMemberMore').hide();
                    } else {
                        $('#loadMemberMore').show();
                    }
                }

            });
        }// 회원목록 로드 끝

        // 쿠폰목록 로드 시작
        function couponList(append = false){
            $.ajax({
               url: '/admin/coupons',
               type: 'GET',
               dataType: 'json',
                success:function(response){
                const couponTable = $('#couponTable tbody');
                if(!append) couponTable.empty();
                $.each(response.coupons, function(index, coupon){
                    console.log(coupon.id);
                   const row = $('<tr>');
                   row.html(`
                        <td>${coupon.benefit}</td>
                        <td>${coupon.title}</td>
                        <td>${coupon.period}</td>
                        <td>${coupon.quantity}</td>
                        <td>${coupon.status}</td>
                   `);
                   couponTable.append(row);
                });
                    const remingCount = Math.max(0, response.totalCoupon - (offset + limit));
                    $('#loadCouponMore').text('더보기(' + remingCount + ')');
                    if (remingCount <= 0) {
                        $('#loadCouponMore').hide();
                    } else {
                        $('#loadCouponMore').show();
                    }
                }
            });
        }


        // 공지사항 링크 클릭 모달 핸들러
        function showNoticeModal(event) {
            event.preventDefault();
            const notice = $(this).data();

            $('#noticeModalId').val(notice.id);
            $('#noticeModalTitle').val(notice.noticetitle);
            $('#noticeModalContent').val(notice.noticecontent);
            $('#noticeModalCount').text(notice.noticecount);
            $('#noticeModalModifiedDate').text(formatDate(notice.modifieddate));
            $('#noticeModal').show();
        }

        // 초기 공지사항 목록 로드
        $('#noticeList').click(function (event) {
            event.preventDefault();
            $('#noticesTable, #loadNoticeMore, #noticeEdit').show();
            $('#membersTable, #loadMemberMore').hide();
            $('#faqsDivList').hide();
            $('#categoryDivList').hide();
            $('#couponDivList, #loadCouponMore').hide();
            noticeList(offset, limit);
        });

        // 초기 회원정보 목록 로드
        $('#memberList').click(function (event) {
            event.preventDefault();
            $('#membersTable, #loadMemberMore').show();
            $('#faqsDivList').hide();
            $('#noticesTable, #loadNoticeMore, #noticeEdit').hide();
            $('#categoryDivList').hide();
            $('#couponDivList, #loadCouponMore').hide();
            memberList(offset, limit);
        });

        // category 목록 로드
        $('#categoryList').click(function(event){
            event.preventDefault();
            $('#noticesTable, #loadNoticeMore, #noticeEdit').hide();
            $('#membersTable, #loadMemberMore').hide();
            $('#faqsDivList').hide();
            $('#couponDivList, #loadCouponMore').hide();
            $('#categoryDivList').show();
            $('.tab-item[data-title="MEN"]').addClass('active');
            categoryList('MEN');
        });

        // coupon 목록 로드
        $('#couponList').click(function(event){
           event.preventDefault();
            $('#noticesTable, #loadNoticeMore, #noticeEdit').hide();
            $('#membersTable, #loadMemberMore').hide();
            $('#faqsDivList').hide();
            $('#categoryDivList').hide();
            $('#couponDivList').show();
            couponList(offset, limit);
        });

        // 공지사항 더보기 버튼 클릭 이벤트
        $('#loadNoticeMore').click(function () {
            offset += limit;
            noticeList(offset, limit);
        });

        // 회원정보 더보기 버튼 클릭 이벤트
        $('#loadMemberMore').click(function () {
            offset += limit;
            memberList(offset, limit);
        });

        $('#loadCouponMore').click(function (){
           offset += limit;
           couponList(offset, limit);
        });

        // 날짜 포맷
        function formatDate(dateString) {
            const date = new Date(dateString);
            const year = date.getFullYear();
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const day = String(date.getDate()).padStart(2, '0');
            return `${year}-${month}-${day}`;
        }

        // 공지사항 모달페이지 수정
        $('#editNoticeBtn').click(function () {

            const noticeId = $('#noticeModalId').val();
            // 수정할 데이터 객체 생성
            const updateNoticeData = {
                noticeTitle: $('#noticeModalTitle').val(),
                noticeContent: $('#noticeModalContent').val(),
                noticeCount: $('#noticeModalCount').text()
            };

            $.ajax({
                url: "/admin/noticeEdit/" + noticeId,
                type: 'POST',
                contentType: 'application/json',
                data: JSON.stringify(updateNoticeData),
                success: function (response) {
                    alert('수정 완료');
                    // window.location.reload();
                    noticeList(0, offset + limit);
                    $('#noticeModal').hide();
                },
                error: function (xhr, status, error) {
                    console.error(error);
                }
            });
        });

        // 공지사항 삭제
        $('#deleteNoticeBtn').click(function () {

            if (confirm("삭제하시겠습니까?")) {
                const noticeId = $('#noticeModalId').val();

                $.ajax({
                    url: '/admin/noticeDelete/' + noticeId,
                    type: 'DELETE',
                    success: function (response) {
                        alert('삭제 완료');
                        noticeList(0, offset + limit);
                        $('#noticeModal').hide();
                    },
                    error: function (xhr, status, error) {
                        console.log(error);
                    }
                });
            } else {

            }
        });

        // 모달 닫기
        $('.close').click(function () {
            $('#noticeModal').hide();
            $('#faqEditModal').hide();
            $('#faqUpdateModal').hide();
            $('#CouponEditModal').hide();
        });

        $('#cancelEditFaqBtn').click(function () {
            $('#faqEditModal').hide();
        });

        $('#cancelEditCouponBtn').click(function(){
            $('#CouponEditModal').hide();
        });

        $(window).click(function (event) {
            if (event.target.id === 'noticeModal') {
                $('#noticeModal').hide();
            } else if (event.target === $('#faqEditModal')[0]) {
                $('#faqEditModal').hide();
            } else if (event.target === $('#faqUpdateModal')[0]) {
                $('#faqUpdateModal').hide();
            } else if(event.target === $('#CouponEditModal')[0]) {
                $('#CouponEditModal').hide();
            }
        });

        // faq 시작
        // 초기 faq 목록 로드
        $('#faqList').click(function (event) {
            event.preventDefault();
            $('#faqsDivList').show();
            $('#membersTable, #loadMemberMore').hide();
            $('#noticesTable, #loadNoticeMore, #noticeEdit').hide();
            $('#categoryDivList').hide();
            let tag = document.getElementsByClassName("active")[0].getAttribute("id").toUpperCase();
            loadFaqContent(tag);
        });

        // faq 글쓰기 모달 selectbox로 데이터가져오기
        $('#faqEditBtn').click(function (event) {
            event.preventDefault();
            $('#faqEditModal').show();
            loadTagList();
        });

        $('#couponEditBtn').click(function (event) {
           event.preventDefault();

            $('#CouponEditTitle').val('');
            $('#CouponEditCode').val('');
            $('#CouponEditPeriod').val('');
            $('#CouponEditBenefit').val('5');
            $('#CouponEditQuantity').val('');
            $('#CouponEditModal').show();

        });

        // faq SelectBox Tag 목록 로드
        function loadTagList() {
            $.ajax({
                url: '/admin/faqTagList',
                type: 'GET',
                success: function (tagList) {
                    const tagEditSelect = $('#tagEditSelect');
                    tagEditSelect.empty();
                    tagList.forEach(tag => {
                        tagEditSelect.append(new Option(tag.tagName, tag.value))
                    });
                },
                error: function (xhr, status, error) {
                    log.error('태그 로드 실패' + error);
                }
            });
        }

        // faq 등록
        $('#editFaqBtn').click(function () {
            const dataForm = {
                tag: $('#tagEditSelect').val(),
                question: $('#faqEditQuestionModalContent').val(),
                answer: $('#faqEditAnswerModalContent').val()
            };

            $.ajax({
                url: '/admin/faqEdit',
                type: 'POST',
                contentType: 'application/json',
                data: JSON.stringify(dataForm),
                success: function (response) {
                    alert('저장완료');
                    $('#faqEditModal').hide();
                    let activeTag = $('.tabs li.active').attr('id').toUpperCase();
                    loadFaqContent(activeTag, '', pageNumber);
                },
                error: function (xhr, status, error) {
                    console.error('저장실패' + error);
                }
            });
        });

        // faq 수정
        $('#updateFaqBtn').click(function(event) {
            event.preventDefault();
            const faqId = $('#faqUpdateId').val();
            const updateFaqData = {
                tag: $('#tagUpdateSelect').val(),
                question: $('#faqUpdateQuestionModalContent').val(),
                answer: $('#faqUpdateAnswerModalContent').val()
            };
            $.ajax({
                url: '/admin/faqEdit/' + faqId,
                type: 'PUT', // PUT으로 변경
                contentType: 'application/json',
                data: JSON.stringify(updateFaqData),
                success: function (response) {
                    alert('수정완료');
                    $('#faqUpdateModal').hide();
                    let activeTag = $('.tabs li.active').attr('id').toUpperCase();
                    loadFaqContent(activeTag, '', pageNumber);
                },
                error: function (xhr, status, error) {
                    console.error('fsq 수정 실패' + error);
                }
            });
        });
        // faq 삭제
        $('#deleteFaqBtn').click(function(event) {
            event.preventDefault();
            if (confirm("삭제하시겠습니까?")) {
                const faqId = $('#faqUpdateId').val();
                $.ajax({
                    url: '/admin/faqDelete/' + faqId,
                    type: 'DELETE',
                    success: function (response) {
                        alert('삭제 완료');
                        $('#faqUpdateModal').hide();
                        let activeTag = $('.tabs li.active').attr('id').toUpperCase();
                        loadFaqContent(activeTag, '', 0);
                    },
                    error: function (xhr, status, error) {
                        console.error('fsq 삭제 실패' + error);
                    }
                });
            } else {

            }
        });

        // faq 시작
        let resTag = $("ul.tabs input").val();
        let keyword = $("#condition-hidden").val();
        $("#condition").val(keyword);

        //탭 이동
        changeActive(resTag);

        //li 클릭이벤트로 폼 전송
        $('ul.tabs li').click(function () {
            pageNumber = 0;

            //클래스 수정
            $('li').removeClass('active');
            $(this).addClass('active');

            let tag = $(this).attr('id').toUpperCase();
            let condtion = $('#condition-hidden').val();
            $('#submitBtn').click();
        });

        //검색 버튼 클릭 이벤트
        $('#submitBtn').click(function () {
            pageNumber = 0;
            faqSearchBtn();
        });

        function loadFaqContent(tag = '', condition = '', page = 0) {
            $.ajax({
                url: '/admin/faqsList',
                method: 'GET',
                data: {tag: tag.toUpperCase(), condition: condition, page: page},
                success: function (response) {
                    const faqDivContents = $('#faqsDivList .contents');
                    faqDivContents.empty();
                    $.each(response.contents, function (index, contents) {
                        const row = $('<div>');
                        row.html(`
                            <div class="content">
                            <div class="question"><p><a href="#" class="editModal-link" data-id="${contents.id}" data-question="${contents.question}" data-answer="${contents.answer}" data-tag="${contents.tag}">${contents.question}</a></p></div>
                            <div class="answer"><p>${contents.answer}</p></div>
                            </div>
                        `);
                        faqDivContents.append(row);
                    });
                    $('.editModal-link').click(editModal);

                    $('#page').val(page);

                    if (response.count <= 0) {
                        $('#pagingBtn').hide();
                    } else {
                        $('#pagingBtn').show();
                        $('#pagingBtn').text('더보기(' + response.count + ')');
                    }
                },
                error: function (error) {
                    console.error('Error', error);
                }
            });
        }

        // faq 링크 클릭 모달 핸들러
        function editModal(event) {
            event.preventDefault();
            const faqs = $(this).data();

            $('#faqUpdateId').val(faqs.id);
            $('#faqUpdateQuestionModalContent').val(faqs.question);
            $('#faqUpdateAnswerModalContent').val(faqs.answer);

            // 카테고리 옵션 추가
            addOptionsToModal([
                {value: 'ALL', text: '전체'},
                {value: 'WEBSITE', text: '웹사이트'},
                {value: 'MILEAGE', text: '통합 마일리지'},
                {value: 'REPAIR', text: '수선'},
                {value: 'STORE', text: '매장 관련'},
                {value: 'PRODUCT', text: '제품'},
                {value: 'MEMBERS', text: '멤버스'},
                {value: 'RETURN', text: '교환/반품'}
            ]);
            $('#tagUpdateSelect').val(faqs.tag);

            $('#faqUpdateModal').show();
        }

        function addOptionsToModal(tags) {
            let selectElement = $('#tagUpdateSelect');
            selectElement.empty(); // 기존의 옵션들 제거

            // 옵션 추가
            tags.forEach(function (tag) {
                let option = $('<option></option>').attr('value', tag.value).text(tag.text);
                selectElement.append(option);
            });
        }

        function faqSearchBtn() {
            let tag = document.getElementsByClassName("active")[0].getAttribute("id").toUpperCase();
            let page = pageNumber;
            let condition = $('#condition').val();

            $.ajax({
                url: '/admin/faqsList',
                method: 'GET',
                data: {tag: tag, page: page, condition: condition},
                success: function (response) {
                    const faqDivContents = $('#faqsDivList .contents');
                    faqDivContents.empty();
                    $.each(response.contents, function (index, contents) {

                        const row = $('<div>');
                        row.html(`
                            <div class="content">
                            <div class="question"><p><a href="#" class="editModal-link" data-id="${contents.id}" data-question="${contents.question}" data-answer="${contents.answer}" data-tag="${contents.tag}">${contents.question}</a></p></div>
                            <div class="answer"><p>${contents.answer}</p></div>
                            </div>
                        `);
                        faqDivContents.append(row);
                    });
                    $('.editModal-link').click(editModal);

                    $('#page').val(page);

                    if (response.count <= 0) {
                        $('#pagingBtn').hide();
                    } else {
                        $('#pagingBtn').show();
                        $('#pagingBtn').text('더보기(' + response.count + ')');
                    }
                },
                error: function (error) {
                    console.error('Error:', error);
                }
            });
        }

        //더보기 버튼 클릭 이벤트
        $('#pagingBtn').click(function () {
            paging();
        });

        function paging() {
            pageNumber++; //페이지 번호 증가
            $.get('/admin/api/faqs', {
                page: pageNumber,
                condition: $("#condition").val(),
                tag: document.getElementsByClassName("active")[0].getAttribute("id").toUpperCase()
            })
                .done(data => {
                    let contents = data.contents;
                    let count = data.count;
                    let divContents = $("div.contents");
                    contents.forEach(contents => {
                        divContents.append(`
                           <div class="content"></div>
                           <div class="questrion"><p><a href="" class="editModal-link" data-id="${contents.id}" data-question="${contents.question}" data-answer="${contents.answer}" data-tag="${contents.tag}">${contents.question}</a></p></div>
                           <div class="answer"><p>${contents.answer}</p></div>
                        `)
                    });
                    $('.editModal-link').click(editModal);

                    $("#pagingBtn").text('더보기(' + data.count + ')');

                    if (count === 0) {
                        $("#pagingBtn").hide();
                    }
                })
                .fail(error => {
                    console.error('Error', error);
                });
        }

        function changeActive(resTag) {
            $('li').removeClass('active');

            switch (resTag) {
                case "ALL":
                    $("#all").addClass("active");
                    break;
                case "WEBSITE":
                    $("#website").addClass("active");
                    break;
                case "MILEAGE":
                    $("#mileage").addClass("active");
                    break;
                case "REPAIR":
                    $("#repair").addClass("active");
                    break;
                case "STORE":
                    $("#store").addClass("active");
                    break;
                case "PRODUCT":
                    $("#product").addClass("active");
                    break;
                case "MEMBERS":
                    $("#members").addClass("active");
                    break;
                case "RETURN":
                    $("#return").addClass("active");
                    break;
                default:
                    $("#all").addClass("active");
                    break;
            }
        }

        //Enter 검색
        $('#condition').on('keypress',function(event){
            if(event.keyCode === 13) {
                event.preventDefault();
                pageNumber = 0; // Enter 검색 시 페이지 번호 초기화
                const tag = document.getElementsByClassName('active')[0].getAttribute('id').toUpperCase();
                loadFaqContent(tag);
            }
        });

        // 카테고리 목록 시작
        function categoryList(title){
            $.ajax({
                url: '/admin/categoryList',
                type: 'GET',
                data: { title: title },
                success: function(data){
                    var categoryDtos = data.categoryDtos;

                    if(Array.isArray(categoryDtos)){
                        var ulFeatured = $('#ul_Featured');
                        var ulShoes = $('#ul_Shoes');
                        var ulSupplies = $('#ul_Supplies');
                        var ulUnderwear = $('#ul_Underwear');
                        var ulClothing = $('#ul_Clothing');
                        var ulSports = $('#ul_Sports');
                        var ulYearRound = $('#ul_YearRound');

                        ulFeatured.empty();
                        ulShoes.empty();
                        ulClothing.empty();
                        ulSupplies.empty();
                        ulUnderwear.empty();
                        ulSports.empty();
                        ulYearRound.empty();

                        categoryDtos.forEach(function(category) {
                            if(title !== "KIDS"){
                                if (category.ref === 1) {
                                    ulFeatured.append('<li id="' + category.id + '" data-step="' + category.step + '">' + category.name + '</li>');
                                } else if (category.ref === 2) {
                                    ulShoes.append('<li id="' + category.id + '" data-step="' + category.step + '">' + category.name + '</li>');
                                } else if (category.ref === 3) {
                                    ulClothing.append('<li id="' + category.id + '" data-step="' + category.step + '">' + category.name + '</li>');
                                } else if(category.ref === 4) {
                                    ulSupplies.append('<li id="' + category.id + '" data-step="' + category.step + '">' + category.name + '</li>');
                                } else if(category.ref === 5) {
                                    ulUnderwear.append('<li id="' + category.id + '" data-step="' + category.step + '">' + category.name + '</li>');
                                } else if(category.ref === 6) {
                                    ulSports.append('<li id="' + category.id + '" data-step="' + category.step + '">' + category.name + '</li>');
                                }
                                $('#cateKids').hide();
                                $('#cateUnderwear').show();
                                $('#cateSports').show();
                                ulListHeight();
                            } else {
                                if (category.ref === 1) {
                                    ulFeatured.append('<li id="' + category.id + '" data-step="' + category.step + '">' + category.name + '</li>');
                                } else if (category.ref === 2) {
                                    ulShoes.append('<li id="' + category.id + '" data-step="' + category.step + '">' + category.name + '</li>');
                                } else if (category.ref === 3) {
                                    ulClothing.append('<li id="' + category.id + '" data-step="' + category.step + '">' + category.name + '</li>');
                                } else if(category.ref === 4) {
                                    ulSupplies.append('<li id="' + category.id + '" data-step="' + category.step + '">' + category.name + '</li>');
                                } else if(category.ref === 7) {
                                    ulYearRound.append('<li id="' + category.id + '" data-step="' + category.step + '">' + category.name + '</li>');
                                }
                                $('#cateKids').show();
                                $('#cateUnderwear').hide();
                                $('#cateSports').hide();
                                ulListHeight();
                            }
                        });
                    } else {
                        console.log('not array');
                    }
                },
                error: function(error){
                    console.log('Error:', error);
                }
            });
        }
        // 탭 클릭시 이동
        $('.tab-item').on('click', function(){
            // 모든 탭에서 active 클래스 제거하고 클릭된 탭에 active 추가
            $('.tab-item').removeClass('active');
            $(this).addClass('active');

            // 현재 설정된 탭의 타이틀 가져오기
            const title = $(this).data('title');

            categoryList(title);
            $('#depth_1, #depth_2, #depth_3, #depth_4, #depth_5, #depth_6, #depth_7').val('');
        });

        // 추가, 수정, 삭제 함수
        function multiCategory(ref, action, selectedText, title, categoryId) {
            const text = $('#depth_' + ref).val();
            let step;

            if (action === 'addItem') {
                step = $('#' + getSelectedListId(title)[ref - 1] + ' li').length + 1;
                categoryId = null; // 추가 시 id를 null로 설정
            } else {
                step = selectedText.data('step');
            }

            console.log({ id: categoryId, name: text, ref: ref, step: step, title: title })

            $.ajax({
                url: '/admin/' + action + (categoryId ? '/' + categoryId : ''),
                type: 'POST',
                contentType: 'application/json',
                data: JSON.stringify({ id: categoryId,  name: text, ref: ref, step: step, title: title }),
                success: function(data) {
                    if (action === 'addItem') {
                        const newId = data.id
                        $('#' + getSelectedListId(title)[ref - 1]).append('<li id="' + newId + '" data-step="' + step + '">' + text + '</li>');
                        $('#depth_' + ref).val('');
                        categoryList(title);
                    } else if (action === 'editItem') {
                        selectedText.text(text);
                        $('#depth_' + ref).val('');
                        categoryList(title);
                    } else if (action === 'deleteItem') {
                        selectedText.remove();
                        $('#depth_' + ref).val('');
                        categoryList(title);
                    }
                },
                error: function(xhr, status, error) {
                    console.error('Error:', error);
                    alert('서버 오류가 발생했습니다.');
                }
            });
        }
        function getSelectedListId(title) {
            switch (title) {
                case 'MEN':
                case 'WOMEN':
                    return ['ul_Featured', 'ul_Shoes', 'ul_Clothing', 'ul_Supplies', 'ul_Underwear', 'ul_Sports'];
                case 'KIDS':
                    return ['ul_Featured', 'ul_Shoes', 'ul_Clothing', 'ul_Supplies', '','','ul_YearRound']; // KIDS의 설정된 ref값 만큼의 배열의 길이가 필요, ul_Supplies, ul_Underwear는 사용하지 않는 태그로 공백처리로 배열의 값 설정
                default:
                    return [];
            }
        }

        // 추가, 수정, 삭제 버튼 클릭 시 이벤트 처리
        for (let i = 1; i <= 10; i++) {
            $('#depth_' + i + '_BtnAdd').click(function() {
                const title = $('.category_tabs .tab-item.active').data('title');
                console.log(title);
                multiCategory(i, 'addItem', null, title, null);
            });

            $('#depth_' + i + '_BtnEdit').click(function() {
                const selectedText = $('#' + getSelectedListId($('.category_tabs .tab-item.active').data('title'))[i - 1] + ' li.selected');
                console.log(selectedText);
                if (selectedText.length) {
                    const title = $('.category_tabs .tab-item.active').data('title');
                    const categoryId = selectedText.attr('id');
                    multiCategory(i, 'editItem', selectedText, title, categoryId);
                } else {
                    alert('수정할 항목을 선택하세요.');
                }
            });


            $('#depth_' + i + '_BtnDelete').click(function() {
                const selectedText = $('#' + getSelectedListId($('.category_tabs .tab-item.active').data('title'))[i - 1] + ' li.selected');
                if (selectedText.length) {
                    const title = $('.category_tabs .tab-item.active').data('title');
                    const categoryId = selectedText.attr('id'); // 선택된 아이템의 ID를 가져옴
                    multiCategory(i, 'deleteItem', selectedText, title, categoryId);
                } else {
                    alert('삭제할 항목을 선택하세요.');
                }
            });
        }

        $(document).on('click', '#ul_Featured li, #ul_Shoes li, #ul_Clothing li, #ul_Supplies li, #ul_Underwear li, #ul_Sports li, #ul_YearRound li', function(){
           $(this).siblings().removeClass('selected');
           $(this).addClass('selected');

           const parentId = $(this).parent().attr('id');
           const text = $(this).text();

           if(parentId === 'ul_Featured') {
               $('#depth_1').val(text);
           } else if(parentId === 'ul_Shoes') {
                $('#depth_2').val(text);
           } else if(parentId === 'ul_Clothing') {
               $('#depth_3').val(text);
           } else if(parentId === 'ul_Supplies') {
               $('#depth_4').val(text);
           } else if(parentId === 'ul_Underwear') {
               $('#depth_5').val(text);
           } else if(parentId === 'ul_Sports') {
               $('#depth_6').val(text);
           } else if(parentId === 'ul_YearRound') {
               $('#depth_7').val(text);
           }
        });

        // 동적 li태그 추가 시 높이 자동맞춤
        function ulListHeight() {
            const uls = document.querySelectorAll('.depth ul');
            let maxHeight = 0;

            uls.forEach(ul => {
                ul.style.height = 'auto';
                if (ul.clientHeight > maxHeight) {
                    maxHeight = ul.clientHeight;
                }
            });

            uls.forEach(ul => {
                ul.style.height = maxHeight + 'px';
            });
        }

        // 쿠폰코드 생성 버튼 호출
        $('#randomCodeBtn').click(function(){
            randomCode();
        });

        // 쿠폰코드 생성 함수
        function randomCode(){
            let characters = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ';
            let code = '';
            for (let i = 0; i < 9; i++ ) {
                code += characters.charAt(Math.floor(Math.random() * characters.length));
            }
            $('#CouponEditCode').val(code);
        }

        // jQuery 달력위젯
        $(function() {
            $('#CouponEditPeriod').datepicker({
                dateFormat: 'yy-mm-dd',
                showMonthAfterYear: true,
                changeYear: true,
                changeMonth: true,
                monthNamesShort: ['1월','2월','3월','4월','5월','6월','7월','8월','9월','10월','11월','12월'],
                dayNamesMin: ['일','월','화','수','목','금','토']
            });
        });


    });
</script>
</body>
</html>